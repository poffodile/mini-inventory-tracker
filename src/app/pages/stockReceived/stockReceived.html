<!-- ========= PAGE: STOCK RECEIVED =========
   - search + date filters
   - newest/oldest toggle
   - export CSV/JSON
   - table is DaisyUI and IDs are monospace
================================================ -->

<div class="space-y-6">
  <header class="flex items-center justify-between">
    <h1 class="text-2xl font-bold">Stock Received</h1>
    <div class="join">
      <button class="btn btn-sm join-item" (click)="toggleSort()">
        Sort: {{ sortDir === 'desc' ? 'Newest first' : 'Oldest first' }}
      </button>
      <button class="btn btn-sm btn-outline join-item" (click)="exportCSV()">Export CSV</button>
      <button class="btn btn-sm btn-outline join-item" (click)="exportJSON()">Export JSON</button>
    </div>
  </header>

  <!-- Filters -->
  <section class="grid gap-3 sm:grid-cols-3">
    <label class="form-control">
      <span class="label-text">Search (product, bin, ref, id)</span>
      <input
        class="input input-bordered"
        type="text"
        placeholder="e.g. MAT-7789, A1-01-01, PO123…"
        [(ngModel)]="searchText"
        (input)="onSearchInput()"
      />
    </label>

    <label class="form-control">
      <span class="label-text">From</span>
      <input
        class="input input-bordered"
        type="date"
        [(ngModel)]="dateFrom"
        (change)="applyFilters(true)"
      />
    </label>

    <label class="form-control">
      <span class="label-text">To</span>
      <input
        class="input input-bordered"
        type="date"
        [(ngModel)]="dateTo"
        (change)="applyFilters(true)"
      />
    </label>
  </section>

  <!-- Table -->
  <section class="shadow card bg-base-100">
    <div class="card-body">
      <div class="overflow-x-auto">
        <table class="table table-zebra">
          <thead>
            <tr>
              <th>ID</th>
              <th>Product</th>
              <th>To Bin</th>
              <th class="w-20 text-right">Qty</th>
              <th>Ref</th>
              <th>When</th>
            </tr>
          </thead>
          <tbody>
            @for (m of paged; track m.id) {
            <tr>
              <td class="font-mono">{{ m.id || '-' }}</td>
              <td>
                {{ productLabel(m.productId) }}
                <span class="font-mono opacity-60">({{ m.productId }})</span>
              </td>
              <td class="font-mono">
                {{ locationLabel(m.toLocationId) }}
                <span class="opacity-60">({{ m.toLocationId }})</span>
              </td>
              <td class="font-mono text-right text-success">+{{ m.qty }}</td>
              <td class="font-mono">{{ m.ref || '-' }}</td>
              <td>{{ m.timestamp | date : 'medium' }}</td>
            </tr>
            }
          </tbody>
        </table>

        <div *ngIf="filtered.length === 0" class="mt-3 alert">
          <span>No receipts found for this filter.</span>
        </div>

        <!-- Pager + totals -->
        <div class="flex items-center justify-between mt-4">
          <div class="text-sm opacity-70">
            Page {{ page }} / {{ totalPages }} — Showing {{ paged.length }} of
            {{ filtered.length }} rows — Qty (page): {{ totalQtyPage }} • Qty (all):
            {{ totalQtyVisible }}
          </div>
          <div class="join">
            <button class="btn btn-sm join-item" (click)="prevPage()" [disabled]="page === 1">
              Prev
            </button>
            <button
              class="btn btn-sm join-item"
              (click)="nextPage()"
              [disabled]="page === totalPages"
            >
              Next
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
