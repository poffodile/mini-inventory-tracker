<!-- ========= PAGE: CURRENT STOCK =========
   - table shows product/bin balances from my 'stockledger'
   - search + filters + sort + paging
   - DaisyUI components, IDs are monospace for clarity
================================================== -->

<div class="space-y-6">
  <header class="flex items-center justify-between">
    <h1 class="text-2xl font-bold">Current Stock</h1>
    <div class="hidden join sm:inline-flex">
      <a class="btn btn-outline join-item" routerLink="/receive">Log Goods Receipt</a>
      <a class="btn join-item" routerLink="/pick">Create Pick Task</a>
    </div>
  </header>

  <!-- Filters -->
  <section class="grid gap-3 sm:grid-cols-3">
    <label class="form-control">
      <span class="label-text">Search</span>
      <input
        class="input input-bordered"
        type="text"
        placeholder="Product, Bin or Qty…"
        [(ngModel)]="searchText"
        (input)="onSearch()"
      />
    </label>

    <label class="form-control">
      <span class="label-text">Product</span>
      <select
        class="select select-bordered"
        [(ngModel)]="productFilter"
        (change)="onFilterChange()"
      >
        <option value="">All products</option>
        <option *ngFor="let pid of productOptions" [value]="pid">
          {{ productLabel(pid) }} <span class="opacity-60">({{ pid }})</span>
        </option>
      </select>
    </label>

    <label class="form-control">
      <span class="label-text">Location (Bin)</span>
      <select
        class="select select-bordered"
        [(ngModel)]="locationFilter"
        (change)="onFilterChange()"
      >
        <option value="">All bins</option>
        <option *ngFor="let lid of locationOptions" [value]="lid">
          {{ locationLabel(lid) }} <span class="opacity-60">({{ lid }})</span>
        </option>
      </select>
    </label>
  </section>

  <!-- Table -->
  <section class="shadow card bg-base-100">
    <div class="card-body">
      <div class="flex items-center justify-between">
        <h2 class="card-title">Balances</h2>

        <!-- sort controls -->
        <div class="join">
          <button class="btn btn-sm join-item" (click)="setSort('product')">
            Sort: Product {{ sortKey === 'product' ? '(' + sortDir + ')' : '' }}
          </button>
          <button class="btn btn-sm join-item" (click)="setSort('location')">
            Location {{ sortKey === 'location' ? '(' + sortDir + ')' : '' }}
          </button>
          <button class="btn btn-sm join-item" (click)="setSort('qty')">
            Qty {{ sortKey === 'qty' ? '(' + sortDir + ')' : '' }}
          </button>
        </div>
      </div>

      <div class="overflow-x-auto">
        <table class="table table-zebra">
          <thead>
            <tr>
              <th>Product</th>
              <th>Bin</th>
              <th class="w-24 text-right">Qty</th>
            </tr>
          </thead>
          <tbody>
            @for (r of paged; track r.productId + '-' + r.locationId) {
            <tr>
              <td>
                {{ productLabel(r.productId) }}
                <span class="font-mono opacity-60">({{ r.productId }})</span>
              </td>
              <td class="font-mono">{{ locationLabel(r.locationId) }} ({{ r.locationId }})</td>
              <td class="font-mono text-right">{{ r.qty }}</td>
            </tr>
            }
          </tbody>
        </table>

        <div *ngIf="filtered.length === 0" class="mt-3 alert">
          <span>No stock found.</span>
        </div>

        <!-- Pager -->
        <div class="flex items-center justify-between mt-4">
          <div class="text-sm opacity-70">
            Page {{ page }} / {{ totalPages }} — Showing {{ paged.length }} of
            {{ filtered.length }} rows
          </div>
          <div class="join">
            <button class="btn btn-sm join-item" (click)="prevPage()" [disabled]="page === 1">
              Prev
            </button>
            <button
              class="btn btn-sm join-item"
              (click)="nextPage()"
              [disabled]="page === totalPages"
            >
              Next
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
