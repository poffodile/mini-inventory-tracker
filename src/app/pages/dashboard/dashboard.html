<!-- =========================================
     DASHBOARD WRAPPER
     ========================================= -->
<div class="space-y-6">
  <!-- ===== PAGE HEADER: title + action buttons ===== -->
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-bold">Dashboard</h1>

    <!-- header actions -->
    <div class="join">
      <button class="btn btn-outline join-item" (click)="loadDemo()" aria-label="Load demo data">
        Load Demo
      </button>
      <button class="btn btn-outline join-item" (click)="clearAll()" aria-label="Clear all data">
        Clear
      </button>
      <button
        class="btn btn-outline join-item"
        (click)="exportMovementsJSON()"
        aria-label="Export movements JSON"
      >
        Export JSON
      </button>
      <button
        class="btn btn-outline join-item"
        (click)="exportCurrentStockCSV()"
        aria-label="Export current stock CSV"
      >
        Export CSV
      </button>
    </div>
  </div>

  <!-- ===== KPI STRIP (DaisyUI stats) ===== -->
  <div class="w-full shadow stats stats-vertical lg:stats-horizontal bg-base-100">
    <!-- products -->
    <div class="stat">
      <div class="stat-title">Products</div>
      <div class="stat-value">{{ totalProducts }}</div>
    </div>
    <!-- locations -->
    <div class="stat">
      <div class="stat-title">Locations</div>
      <div class="stat-value">{{ totalLocations }}</div>
    </div>
    <!-- receipts today -->
    <div class="stat">
      <div class="stat-title">Receipts Today</div>
      <div class="stat-value text-success">{{ receiptsToday }}</div>
    </div>
    <!-- picks today -->
    <div class="stat">
      <div class="stat-title">Picks Today</div>
      <div class="stat-value text-error">{{ picksToday }}</div>
    </div>
    <!-- stock total -->
    <div class="stat">
      <div class="stat-title">Current Stock (Total)</div>
      <div class="stat-value">{{ currentStockTotal }}</div>
    </div>
  </div>

  <!-- ===== MAIN GRID (2/3 content + 1/3 sidebar) ===== -->
  <div class="grid grid-cols-1 gap-6 xl:grid-cols-12">
    <!-- -----------------------------------------
         LEFT: RECENT ACTIVITY (spans 8/12 ≈ 2/3)
         ----------------------------------------- -->
    <section class="xl:col-span-8">
      <div class="shadow card bg-base-100">
        <div class="card-body">
          <h2 class="card-title">Recent Activity</h2>

          <!-- table (scrollable height so the page doesn't stretch too tall) -->
          <div class="overflow-x-auto max-h-[70vh] overflow-y-auto">
            <table class="table table-zebra">
              <thead>
                <tr>
                  <th>Type</th>
                  <th>Product</th>
                  <th>Location</th>
                  <th>Qty</th>
                  <th>Ref</th>
                  <th>Time</th>
                </tr>
              </thead>
              <tbody>
                @for (m of recent; track m.id) {
                <tr>
                  <td>
                    <span [class]="typeBadge(m)">{{ m.type }}</span>
                  </td>
                  <td>
                    {{ productName(m.productId) }}
                    <span class="opacity-60">({{ m.productId }})</span>
                  </td>
                  <td>{{ locationName(m.toLocationId || m.fromLocationId) }}</td>
                  <td [class]="m.type === 'PICK' ? 'text-error' : 'text-success'">
                    {{ m.type === 'PICK' ? '-' : '+' }}{{ m.qty }}
                  </td>
                  <td>{{ m.ref }}</td>
                  <td>{{ m.timestamp | date : 'medium' }}</td>
                </tr>
                }
              </tbody>
            </table>

            @if (recent.length === 0) {
            <div class="mt-3 alert"><span>No recent activity yet.</span></div>
            }
          </div>
        </div>
      </div>
    </section>

    <!-- -----------------------------------------
         RIGHT SIDEBAR (spans 4/12 ≈ 1/3)
         Contains: Quick Actions + Low Stock
         ----------------------------------------- -->
    <aside class="space-y-6 xl:col-span-4">
      <!-- Quick Actions widget -->
      <div class="sticky shadow card bg-base-100 top-20">
        <div class="card-body">
          <h2 class="card-title">Quick Actions</h2>
          <div class="grid grid-cols-2 gap-2">
            <a routerLink="/receive" class="btn btn-primary btn-sm">Receive</a>
            <a routerLink="/pick" class="btn btn-error btn-sm">Dispatch</a>
            <a routerLink="/current-stock" class="col-span-2 btn btn-outline btn-sm"
              >Current Stock</a
            >
          </div>
        </div>
      </div>

      <!-- Low Stock widget -->
      <div class="sticky shadow card bg-base-100 top-56">
        <div class="card-body">
          <h2 class="card-title">
            Low Stock
            <span class="badge badge-warning badge-sm">≤ {{ LOW_STOCK_THRESHOLD }}</span>
          </h2>

          <div class="overflow-x-auto max-h-[40vh] overflow-y-auto">
            <table class="table table-compact">
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Balance</th>
                </tr>
              </thead>
              <tbody>
                @for (row of lowStock; track row.productId) {
                <tr>
                  <td>
                    {{ row.name }} <span class="opacity-60">({{ row.productId }})</span>
                  </td>
                  <td>
                    <span
                      class="badge"
                      [class]="row.balance <= 0 ? 'badge-error' : 'badge-warning'"
                    >
                      {{ row.balance }}
                    </span>
                  </td>
                </tr>
                }
              </tbody>
            </table>

            @if (lowStock.length === 0) {
            <div class="mt-3 alert"><span>No low stock items.</span></div>
            }
          </div>
        </div>
      </div>
    </aside>
  </div>
</div>
